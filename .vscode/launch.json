// {
//     "version": "0.2.0",
//     "configurations": [
//         {
//             "name": "Python: Run Gloo Demo",
//             "type": "debugpy",
//             "request": "launch",
//             "program": "${workspaceFolder}/run_gloo.py",
//             "console": "integratedTerminal",
//             "cwd": "${workspaceFolder}",
//             "args": [
//                 "--arch", "resnet18", // 模型名称
//                 "--complex_arch", "master=resnet18,worker=resnet18", //复杂和简单模型
//                 "--method", "fedhm", // 聚合算法
//                 "--experiment", "demo", 
//                 "--group_norm_num_groups=16",  //组归一化个数
//                 "--data", "cifar10",
//                 "--pin_memory", "True",
//                 "--batch_size", "64",
//                 "--num_workers", "2",   
//                 "--distillation_coefficient", "0",
//                 "--projection=0", // 是否对齐，主要是蒸馏用
//                 "--partition_data", "non_iid_dirichlet",
//                 "--non_iid_alpha", "0.5",
//                 "--train_data_ratio", "1",
//                 "--val_data_ratio", "0.1", // 训练集划分多少给验证集
//                 "--n_clients", "20",
//                 "--participation_ratio", "0.2", // 客户端参与率
//                 "--n_comm_rounds", "200",
//                 "--local_n_epochs", "10",      // 本地轮次
//                 "--world_conf", "0,7,1,1,100", //这里指定GPU序列
//                 "--on_cuda", "True",
//                 //"--fl_aggregate", "scheme=federated_average",
//                 "--optimizer", "sgd",
//                 "--lr", "0.05",
//                 "--local_prox_term", "0",
//                 "--lr_warmup", "False",
//                 "--lr_warmup_epochs", "5",
//                 "--lr_warmup_epochs_upper_bound", "150",
//                 "--lr_scheduler", "MultiStepLR",
//                 "--lr_decay", "0.1",
//                 "--weight_decay", "0", // 权重衰减，不作用于BN层的仿射变换
//                 "--use_nesterov", "False",
//                 "--momentum_factor", "0.9", //sgd的冲量
//                 "--track_time", "True",  // 记录时间
//                 "--display_tracked_time", "True",
//                 "--python_path", "${command:python.interpreterPath}",
//                 "--hostfile", "hostfile",
//                 "--manual_seed", "7",
//                 "--pn_normalize", "True", //数据集是否进程归一化
//                 "--same_seed_process", "True", //是否每个客户端使用相同的种子
//                 "--port","50022",
//                 "--meta","True",
//                 "--decom_rule", "1", "0",
//                 // "--ratio_LR", "0.2",
//                 "--is_random_rank", "True",
//                 "--train_fast", "True",
//                 "--meta_L2", "0.0001",
//                 "--freeze_bn", "True"
//             ]
//         }
//     ]
// }

// avg debug
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Python: Run Gloo Demo",
            "type": "debugpy",
            "request": "launch",
            "program": "${workspaceFolder}/run_gloo.py",
            "console": "integratedTerminal",
            "cwd": "${workspaceFolder}",
            "args": [
                "--arch", "resnet18", // 模型名称
                "--complex_arch", "master=resnet18,worker=resnet18", //复杂和简单模型
                "--method", "fedavg", // 聚合算法
                "--experiment", "demo", 
                "--group_norm_num_groups=16",  //组归一化个数
                "--data", "cifar10",
                "--pin_memory", "True",
                "--batch_size", "64",
                "--num_workers", "2",   
                "--distillation_coefficient", "0",
                "--projection=0", // 是否对齐，主要是蒸馏用
                "--partition_data", "non_iid_dirichlet",
                "--non_iid_alpha", "0.5",
                "--train_data_ratio", "1",
                "--val_data_ratio", "0.1", // 训练集划分多少给验证集
                "--n_clients", "20",
                "--participation_ratio", "0.2", // 客户端参与率
                "--n_comm_rounds", "200",
                "--local_n_epochs", "10",      // 本地轮次
                "--world_conf", "0,7,1,1,100", //这里指定GPU序列
                "--on_cuda", "True",
                //"--fl_aggregate", "scheme=federated_average",
                "--optimizer", "sgd",
                "--lr", "0.05",
                "--local_prox_term", "0",
                "--lr_warmup", "False",
                "--lr_warmup_epochs", "5",
                "--lr_warmup_epochs_upper_bound", "150",
                "--lr_scheduler", "MultiStepLR",
                "--lr_decay", "0.1",
                "--weight_decay", "0", // 权重衰减，不作用于BN层的仿射变换
                "--use_nesterov", "False",
                "--momentum_factor", "0.9", //sgd的冲量
                "--track_time", "True",  // 记录时间
                "--display_tracked_time", "True",
                "--python_path", "${command:python.interpreterPath}",
                "--hostfile", "hostfile",
                "--manual_seed", "7",
                "--pn_normalize", "True", //数据集是否进程归一化
                "--same_seed_process", "True", //是否每个客户端使用相同的种子
                "--port","50022",
                "--resnet_scaling","4"
            ]
        }
    ]
}










//--fl_aggregate scheme=federated_average

/*




    // 81.64%

    // 修改随机秩 修改客户端总数15 origin划分 --meta_L2 0.0001   --lr 0.1

python run_gloo.py \
    --arch resnet18 --complex_arch master=resnet18,worker=resnet18 --method fedhm --experiment demo \
    --group_norm_num_groups=16 --data cifar10 --pin_memory True --batch_size 64 --num_workers 2 \
    --distillation_coefficient 0 --projection=0 --partition_data random --non_iid_alpha 1 \
    --train_data_ratio 1 --val_data_ratio 0.1 --n_clients 15 --participation_ratio 0.2 \
    --n_comm_rounds 200 --local_n_epochs 15 --world_conf 0,7,1,1,100 --on_cuda True \
    --optimizer sgd --lr 0.1 --local_prox_term 0 --lr_warmup False --lr_warmup_epochs 5 \
    --lr_warmup_epochs_upper_bound 150 --lr_scheduler MultiStepLR --lr_decay 0.1 \
    --weight_decay 0 --use_nesterov False --momentum_factor 0.9 --track_time True \
    --display_tracked_time True --python_path /data_B/inspur/anaconda3/envs/zyz_fedgkd/bin/python --hostfile hostfile \
    --manual_seed 7 --pn_normalize True --same_seed_process False --port 50028 \
    --meta True --decom_rule 0 1 --ratio_LR 0.2 --is_random_rank True --train_fast True --meta_L2 0.0001
    

fedhm
python run_gloo.py \
    --arch resnet18 \
    --complex_arch master=resnet18,worker=resnet18 \
    --method fedhm \
    --experiment demo \
    --group_norm_num_groups 16 \
    --data cifar10 \
    --pin_memory True \
    --batch_size 64 \
    --num_workers 2 \
    --distillation_coefficient 0 \
    --projection 0 \
    --partition_data random \
    --non_iid_alpha 0.5 \
    --train_data_ratio 1 \
    --val_data_ratio 0.1 \
    --n_clients 20 \
    --participation_ratio 0.2 \
    --n_comm_rounds 300 \
    --local_n_epochs 50 \
    --world_conf 0,7,1,1,100 \
    --on_cuda True \
    --optimizer sgd \
    --lr 0.05 \
    --local_prox_term 0 \
    --lr_warmup False \
    --lr_warmup_epochs 5 \
    --lr_warmup_epochs_upper_bound 150 \
    --lr_scheduler MultiStepLR \
    --lr_decay 0.1 \
    --weight_decay 0 \
    --use_nesterov False \
    --momentum_factor 0.9 \
    --track_time True \
    --display_tracked_time True \
    --python_path /data_B/inspur/anaconda3/envs/zyz_fedgkd/bin/python \
    --hostfile hostfile \
    --manual_seed 7 \
    --pn_normalize True \
    --same_seed_process False \
    --port 50212 \
    --train_fast True \
    --meta True \
    --decom_rule 0 1 \
    --ratio_LR 0.2 \
    --is_random_rank True \
    --meta_L2 0 \
    --freeze_bn True



    




fedprox
python run_gloo.py \
    --arch resnet8 \
    --complex_arch master=resnet8,worker=resnet8 \
    --method fedprox \
    --experiment demo \
    --group_norm_num_groups 16 \
    --data cifar10 \
    --pin_memory True \
    --batch_size 64 \
    --num_workers 2 \
    --distillation_coefficient 0 \
    --projection 0 \
    --partition_data random \
    --non_iid_alpha 1 \
    --train_data_ratio 1 \
    --val_data_ratio 0.1 \
    --n_clients 15 \
    --participation_ratio 0.2 \
    --n_comm_rounds 200 \
    --local_n_epochs 15 \
    --world_conf 0,7,1,1,100 \
    --on_cuda True \
    --optimizer sgd \
    --lr 0.1 \
    --local_prox_term 0 \
    --lr_warmup False \
    --lr_warmup_epochs 5 \
    --lr_warmup_epochs_upper_bound 150 \
    --lr_scheduler MultiStepLR \
    --lr_decay 0.1 \
    --weight_decay 0.0001 \
    --use_nesterov False \
    --momentum_factor 0.9 \
    --track_time True \
    --display_tracked_time True \
    --python_path /data_B/inspur/anaconda3/envs/zyz_fedgkd/bin/python \
    --hostfile hostfile \
    --manual_seed 7 \
    --pn_normalize True \
    --same_seed_process False \
    --port 50020 \
    --train_fast True


feddyn
python run_gloo.py \
    --arch resnet8 \
    --complex_arch master=resnet8,worker=resnet8 \
    --method feddyn \
    --experiment demo \
    --group_norm_num_groups 16 \
    --data cifar10 \
    --pin_memory True \
    --batch_size 64 \
    --num_workers 2 \
    --distillation_coefficient 0 \
    --projection 0 \
    --partition_data random \
    --non_iid_alpha 1 \
    --train_data_ratio 1 \
    --val_data_ratio 0.1 \
    --n_clients 15 \
    --participation_ratio 0.2 \
    --n_comm_rounds 200 \
    --local_n_epochs 15 \
    --world_conf 0,7,1,1,100 \
    --on_cuda True \
    --optimizer sgd \
    --lr 0.1 \
    --local_prox_term 0 \
    --lr_warmup False \
    --lr_warmup_epochs 5 \
    --lr_warmup_epochs_upper_bound 150 \
    --lr_scheduler MultiStepLR \
    --lr_decay 0.1 \
    --weight_decay 0.0001 \
    --use_nesterov False \
    --momentum_factor 0.9 \
    --track_time True \
    --display_tracked_time True \
    --python_path /data_B/inspur/anaconda3/envs/zyz_fedgkd/bin/python \
    --hostfile hostfile \
    --manual_seed 7 \
    --pn_normalize True \
    --same_seed_process False \
    --port 50027 \
    --train_fast True


fedavg
python run_gloo.py \
    --arch resnet18 \
    --complex_arch master=resnet18,worker=resnet18 \
    --method fedavg \
    --experiment demo \
    --group_norm_num_groups 16 \
    --data cifar10 \
    --pin_memory True \
    --batch_size 64 \
    --num_workers 2 \
    --distillation_coefficient 0 \
    --projection 0 \
    --partition_data random \
    --non_iid_alpha 0.5 \
    --train_data_ratio 1 \
    --val_data_ratio 0.1 \
    --n_clients 20 \
    --participation_ratio 0.2 \
    --n_comm_rounds 300 \
    --local_n_epochs 30 \
    --world_conf 0,7,1,1,100 \
    --on_cuda True \
    --optimizer sgd \
    --lr 0.05 \
    --local_prox_term 0 \
    --lr_warmup False \
    --lr_warmup_epochs 5 \
    --lr_warmup_epochs_upper_bound 150 \
    --lr_scheduler MultiStepLR \
    --lr_decay 0.1 \
    --weight_decay 0.0001 \
    --use_nesterov False \
    --momentum_factor 0.9 \
    --track_time True \
    --display_tracked_time True \
    --python_path /data_B/inspur/anaconda3/envs/zyz_fedgkd/bin/python \
    --hostfile hostfile \
    --manual_seed 7 \
    --pn_normalize True \
    --same_seed_process False \
    --port 50027 \
    --train_fast True \
    --resnet_scaling 4
*/


